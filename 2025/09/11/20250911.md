
3. Terminal communication			 *terminal-communication*

There are several ways to communicate with the job running in a terminal:
- Use |term_sendkeys()| to send text and escape sequences from Vim to the job.
- Use the JSON API to send encoded commands from the job to Vim.
- Use the |client-server| mechanism. This works on machines with an X server
  and on MS-Windows.

For a job that was written for the purpose, you can use the JSON API escape
sequence in the other direction.  E.g.: >
	call term_sendkeys(buf, "\<Esc>]51;["response"]\x07")

Job to Vim: JSON API ~
							*terminal-api*
The job can send JSON to Vim, using a special escape sequence.  The JSON
encodes a command that Vim understands.  Example of such a message: >
	<Esc>]51;["drop", "README.md"]<07>

call term_sendkeys(0, "\<Esc>]51;["drop", "~/temp.txt"]\x07")


```vim
function! Tapi_test(argcnt, dir)
  echomsg 'hello world'
  echomsg a:argcnt
  echomsg a:dir
endfunction
```

```
_synctermcwd_ps1() {
  printf '%s\n' "$PWD"
  printf '\e]51;["call","Tapi_test",["%s"]]\x07' "$PWD"
}
```

```bash
~ $ !!
_synctermcwd_ps1
/home/widehyo
```

```message
hello world
2
['/home/widehyo']
```


```
_synctermcwd_ps1() {
  printf '%s\n' "$PWD"
  printf '\e]51;["call","Tapi_test","%s"]\x07' "$PWD"
}
```

```message
hello world
2
/home/widehyo
```


_synctermcwd_ps1() {
  printf '%s\n' "$PWD"
  printf '\e]51;["call","Tapi_test",["%s","dummy"]]\x07' "$PWD"
}

hello world
2
['/home/widehyo', 'dummy']

```vim
function! Tapi_test(argcnt, dir)
  echomsg 'hello world'
  echomsg a:argcnt
  echomsg a:dir
  for args in a:dir
    echomsg args
  endfor
endfunction
```

hello world
2
['/home/widehyo', 'dummy']
/home/widehyo
dummy
